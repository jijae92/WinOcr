Metadata-Version: 2.4
Name: pdf_text_overlay
Version: 0.1.0
Summary: Overlay invisible text layer onto image-only PDFs to make them searchable
Author: WinOCR Tools
Classifier: Programming Language :: Python :: 3.11
Classifier: Operating System :: Microsoft :: Windows
Classifier: License :: OSI Approved :: MIT License
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: click>=8.1
Requires-Dist: pikepdf>=9.0
Requires-Dist: PyMuPDF>=1.24
Requires-Dist: pillow>=10.0
Provides-Extra: winrt
Requires-Dist: winrt-runtime; extra == "winrt"
Requires-Dist: winrt-Windows.Foundation; extra == "winrt"
Requires-Dist: winrt-Windows.Foundation.Collections; extra == "winrt"
Requires-Dist: winrt-Windows.Media.Ocr; extra == "winrt"
Requires-Dist: winrt-Windows.Globalization; extra == "winrt"
Requires-Dist: winrt-Windows.Graphics.Imaging; extra == "winrt"
Requires-Dist: winrt-Windows.Storage; extra == "winrt"
Requires-Dist: winrt-Windows.Storage.Streams; extra == "winrt"

# PDF Text Overlay

Overlay an invisible text layer on top of image-only PDFs so they become searchable without altering the original visuals.

## Features
- Invisible text insertion using PDF rendering mode 3 (or near-transparent opacity fallback).
- Accept pre-generated OCR JSON or run Windows WinRT OCR on the fly.
- Adjustable baseline ratio, granularity (word/line), whitespace normalisation, hyphen repair, and optional debug overlays.
- Optional best-effort PDF/A-2b output via pikepdf.
- Ships with `pdf_text_overlay` console script **and** `python -m pdf_text_overlay` module entry point.

## Quick install
```powershell
python -m venv .venv
.venv\Scripts\activate
pip install -e .
```

For a regular (non-editable) install:
```powershell
pip install .
```

To enable Windows WinRT OCR support:
```powershell
pip install .[winrt]
```

You can also run the bundled verifier:
```powershell
.\scripts\verify_install.ps1
```

## Usage examples
```powershell
pdf_text_overlay --pdf .\samples\sample1.pdf --out .\out\searchable.pdf --method invisible
pdf_text_overlay --pdf scans.pdf --ocr-json ocr.json --out searchable.pdf --baseline-ratio 0.18 --granularity line
python -m pdf_text_overlay.cli --pdf scans.pdf --out searchable.pdf --method opacity --debug-overlay
```

### Common options
- `--pdf`: Input PDF path (required).
- `--out`: Output searchable PDF path (required).
- `--ocr-json`: Path to OCR JSON (skip live OCR when provided).
- `--dpi`: Render DPI when WinRT OCR runs (default 300).
- `--lang`: WinRT OCR language tag (default `ko-KR`).
- `--granularity`: `word` (default) or `line`.
- `--method`: `invisible` (render mode 3) or `opacity` (alpha ≈ 0.02).
- `--font`: Unicode font file; otherwise system/packaged fonts are attempted, falling back to Helvetica.
- `--baseline-ratio`: Adjust vertical alignment inside bounding boxes.
- `--debug-overlay`: Draw translucent bounding boxes for QA.
- `--keep-spaces`: Preserve original whitespace.
- `--dehyphen`: Rejoin hyphenated line endings.
- `--pdfa`: Attempt PDF/A-2b export (falls back with warning if enforcement fails).
- `--dump-ocr-json`: Persist WinRT OCR results for later runs.
- `--verbose`: Enable debug logging.

## OCR JSON schema
The package ships with `pdf_text_overlay/resources/examples/ocr_schema_example.json` showing the expected structure:
```json
[
  {
    "page": 0,
    "width_px": 2480,
    "height_px": 3508,
    "lines": [
      {"text": "...", "bbox": [x, y, w, h], "words": [...]}
    ],
    "words": [...]
  }
]
```

## WinRT OCR requirements
- Windows 10/11, 64-bit.
- Python 3.11 (64-bit). WSL is not supported.
- Language pack with OCR installed via **Settings → Time & Language → Language & Region**.
- Install extras: `pip install .[winrt]`.

## Troubleshooting
- **“pdf_text_overlay을(를) 인식하지 못합니다”**  
  Install the package (`pip install -e .`) and open a fresh PowerShell so that `<venv>\Scripts` is on `PATH`.  
  Validate with `where python` and `where pdf_text_overlay`.
- **Module command not found**  
  Run `python -m pdf_text_overlay.cli ...` inside the same environment or re-run the verifier script.
- **No WinRT OCR**  
  Ensure you installed the `[winrt]` extras and run outside WSL.
- **Alignment issues**  
  Tune `--baseline-ratio` (e.g., 0.12–0.2) or provide a specific font via `--font`.
- **PDF/A validation**  
  Use a validator such as [veraPDF](https://verapdf.org/) to confirm compliance.

## Development & tests
```powershell
pip install -e .[winrt]  # optional
pytest
```

## License
Released under the MIT License. Packaged fonts (if provided) remain under their respective licenses.
